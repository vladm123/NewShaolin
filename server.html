<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="copyright" content="(c) 2009 2010 Codrin Diţu &amp; Vlad Manea" />
        <meta name="description" content="documentaţia proiectului newshaolin, realizat şi promovat ca proiect final la disciplina Reţele de Calculatoare de studenţii Codrin Diţu &amp; Vlad Manea" />
		<meta name="author" content="Vlad Manea" />
		<meta name="keywords" content="proiect, Reţele de Calculatoare, ştiri, newshaolin, NewsC, NewsS, Codrin Diţu, Vlad Manea, Facultatea de Informatică, Iaşi, România, FII" />
		<meta name="robots" content="all, index, follow" />
		<title>newshaolin | server</title>
		<link rel="stylesheet" href="style/index.css" />
</head>
<body>
    <div class="wide">
		<h1><a href="index.html">new<span class="shaolin">shaolin</span></a></h1>
	</div>
    <div class="outer">
      	<img src="data/structure.jpg" alt="image" width="950" height="250" />        
	</div>
   	<div class="narrow">
        <ul type="disc">
            <li>» <a href="index.html">acasă</a> |</li>
            <li> <a href="problem.html">problemă</a> →</li>
            <li> <a href="solution.html">soluţie</a> |</li>
            <li> <a href="communication.html">comunicare</a> |</li>
            <li> <a href="client.html">client</a> &amp;</li>
            <li> <span class="here">server</span> |</li>
            <li> <a href="development.html">dezvoltare</a> |</li>
            <li> <a href="references.html">bibliografie</a> «</li>
        </ul>
    </div>
    <div class="wide">
        <h2>server</h2>
        <p>Atât serverul, cât şi clientul au fost implementate modular. Fiecare element de conţinut beneficiază de sursele proprii, iar extinderea cu alte elemente de conţinut este facilă. Am izolat secvenţele de cod în care sunt specificate elemente ce pot fi completate ulterior, precum şi pe cele care comunică cu baza de date. Interfaţa clientului este, de asemenea, separată de codul de comunicare şi transfer cu serverul.</p>
        <hr />

        <h3>structură bază de date</h3>
        
        <p>Baza de date a fost modelată conform standardelor modelării datelor:</p>
        <ul type="disc">
        	<li>am normalizat la <span class="italic">3NF</span><sup><a href="references.html#pub2" target="_blank">2</a></sup>, cu excepţia atributului <span class="token">drept</span>, pentru simplitate</li>
            <li>am asigurat integritatea referenţială </li>
            <li>am asigurat unicitatea cheilor</li>
        </ul>

        <a name="img1"></a>
        <p>Prezentăm mai jos diagrama entitate-relaţie:</p>

        <p><img src="data/erd.jpg" width="775" height="400" alt="ERD" /></p>
        
       <p align="center">Imaginea 1. <span class="bold">Diagrama Entitate-Relaţie</span></p>

		<hr />

        <h3>structură server</h3>
        
        <p>Serverul este împărţit în mai multe surse, astfel încât întreg codul să fie uşor de consultat şi reutilizat. Prezentăm mai jos sursele serverului, împreună cu funcţiile şi semnificaţiile fiecărei funcţii în parte.</p>
        
        <h4>surse server</h4>
        <p>Toate sursele serverului pot fi vizualizate <a target="_blank" href="./sources/server/">aici</a>.</p>

        <p><span class="token"><a href="./sources/server/main.c">main.c</a></span> conţine funcţia <span class="token">main</span>, care se ocupă cu gestiunea clienţilor:</p>
        <ul type="disc">
        	<li><span class="token">int main(int argc, char *argv[])</span><br />gestionează clienţii printr-un server concurent forked</li>
        </ul> 
        
        <p><span class="token"><a href="./sources/server/handlers.c">handlers.c</a></span> conţine funcţiile care tratează erorile, citirea, scrierea, precum şi operaţiile cu şirurile de caractere:</p>
        <ul type="disc">
            <li><span class="token">void handle_string(char *str, char *msg, int inc)</span><br />alocă memorie în primul şir şi mută al doilea în el, incremental (prin concatenare) sau nu (prin înlocuire)</li>
            <li><span class="token">void handle_output(char *msg, int inc)</span><br />alocă memorie în şirul trimis înapoi clientului şi îl mută pe cel parametru în el, incremental (prin concatenare) sau nu (prin înlocuire)</li>
            <li><span class="token">void handle_signal(int sig)</span><br />tratează semnalele primite de proces; este utilizată pentru semnalarea terminării unui proces copil</li>
            <li><span class="token">void handle_error(char *name)</span><br />tratează erorile, asigurându-se că memoria este eliberată, dar termină procesul cu eroare</li>
            <li><span class="token">int handle_alphanumerical(char *string, int max)</span><br />calculează lungimea şirului parametru, fără a depăşi un număr maxim de caractere şi înlocuieşte eventuale caractere cu altele</li>
            <li><span class="token">void handle_client()</span><br />se ocupă de client, rezolvând prin răspunsuri cererile</li>
            <li><span class="token">void handle_read()</span><br />citeşte cererea de la client şi se asigură că mesajul de cerere are lungimea corectă</li>
            <li><span class="token">void handle_process()</span><br />se asigură că mesajul de cerere conţine o comandă şi trimite spre selectarea comenzii</li>
            <li><span class="token">void handle_write()</span><br />scrie răspunsul spre client şi se asigură că mesajul de răspuns are lungimea corectă</li>
        </ul> 

        <p><span class="token"><a href="./sources/server/requests.c">requests.c</a></span> conţine funcţia care selectează cererea clientului:</p>
        <ul type="disc">
        	<li><span class="token">int requests()</span><br />selectează comanda cererii clientului şi, dacă este validă, trimite spre rezolvarea ei</li>
        </ul> 

        <p><span class="token"><a href="./sources/server/usersc.c">usersc.c</a></span> conţine funcţiile care tratează acţiunile referitoare la utilizatori, asigurând integritatea datelor, conform <sup><a target="_blank" href="communication.html#tab1">1</a></sup>:</p>
        <ul type="disc">
            <li><span class="token">void c_user_connect()</span><br />conectează utilizatorul, prin citirea şi procesarea datelor</li>
            <li><span class="token">void c_user_disconnect()</span><br />deconectează utilizatorul</li>
            <li><span class="token">void c_user_add()</span><br />înregistrează un utilizator, prin citirea şi procesarea datelor</li>
            <li><span class="token">void c_user_modify()</span><br />modifică un utilizator, prin citirea şi procesarea identificatorului şi datelor</li>
            <li><span class="token">void c_users_view()</span><br />vizualizează utilizatorii</li>
            <li><span class="token">void c_user_view()</span><br />vizualizează un utilizator, prin citirea şi procesarea identificatorului</li>
        </ul> 
        
        <p><span class="token"><a href="./sources/server/catsc.c">catsc.c</a></span> conţine funcţiile care tratează acţiunile referitoare la categorii, asigurând integritatea datelor, conform <sup><a target="_blank" href="communication.html#tab1">1</a></sup>:</p>
        <ul type="disc">
            <li><span class="token">void c_cat_add()</span><br />adaugă o categorie, prin citirea şi procesarea datelor</li>
            <li><span class="token">void c_cat_modify()</span><br />modifică o categorie, prin citirea şi procesarea identificatorului şi datelor</li>
            <li><span class="token">void c_cat_remove()</span><br />şterge o categorie, prin citirea şi procesarea identificatorului</li>
            <li><span class="token">void c_cats_view()</span><br />vizualizează categoriile</li>
            <li><span class="token">void c_cat_view()</span><br />vizualizează o categorie, prin citirea şi procesarea identificatorului</li>
        </ul> 

        <p><span class="token"><a href="./sources/server/newsc.c">newsc.c</a></span> conţine funcţiile care tratează acţiunile referitoare la ştiri, asigurând integritatea datelor, conform <sup><a target="_blank" href="communication.html#tab1">1</a></sup>:</p>
        <ul type="disc">
            <li><span class="token">void c_new_add()</span><br />adaugă o ştire, prin citirea şi procesarea datelor</li>
            <li><span class="token">void c_new_modify()</span><br />modifică o ştire, prin citirea şi procesarea identificatorului şi datelor</li>
            <li><span class="token">void c_new_remove()</span><br />şterge o ştire, prin citirea şi procesarea identificatorului</li>
            <li><span class="token">void c_news_view()</span><br />vizualizează ştirile</li>
            <li><span class="token">void c_new_view()</span><br />vizualizează o ştire, prin citirea şi procesarea identificatorului</li>
        </ul> 

        <p><span class="token"><a href="./sources/server/userssql.c">userssql.c</a></span> conţine funcţiile care tratează acţiunile referitoare la utilizatori, interogând baza de date <span class="italic">MySQL</span>:</p>
        <ul type="disc">
            <li><span class="token">int sql_user_connect(char *username, char *password)</span><br />conectează utilizatorul, prin citirea şi procesarea datelor</li>
            <li><span class="token">int sql_user_add(char *username, char *password)</span><br />înregistrează un utilizator, prin citirea şi procesarea datelor</li>
            <li><span class="token">int sql_user_modify(int id, char *password, int permissions)</span><br />modifică un utilizator, prin citirea şi procesarea identificatorului şi datelor</li>
            <li><span class="token">void sql_users_view()</span><br />vizualizează utilizatorii</li>
            <li><span class="token">int sql_user_view(int id)</span><br />vizualizează un utilizator, prin citirea şi procesarea identificatorului</li>
        </ul> 

        <p><span class="token"><a href="./sources/server/catssql.c">catssql.c</a></span> conţine funcţiile care tratează acţiunile referitoare la categorii, interogând baza de date <span class="italic">MySQL</span>:</p>
        <ul type="disc">
            <li><span class="token">int sql_cat_add(char *name, int catpid)</span><br />adaugă o categorie, prin citirea şi procesarea datelor</li>
            <li><span class="token">int sql_cat_modify(int id, char *name, int catpid)</span><br />modifică o categorie, prin citirea şi procesarea identificatorului şi datelor</li>
            <li><span class="token">int sql_cat_remove(int id)</span><br />şterge o categorie, prin citirea şi procesarea identificatorului</li>
            <li><span class="token">void sql_cats_view(char *id, int lev)</span><br />vizualizează categoriile</li>
            <li><span class="token">int sql_cat_view(int id)</span><br />vizualizează o categorie, prin citirea şi procesarea identificatorului</li>

            <li><span class="token">void sql_cat_view_parents(char *id)</span><br />vizualizează categoriile părinţi ale unei categorii, în mod recursiv, prin citirea şi procesarea identificatorului</li>
            <li><span class="token">int sql_cat_user_exists(int id)</span><br />găseşte propunătorul unei categorii; am folosit funcţia în dublu scop: şi pentru a găsi propunătorul, şi pentru a testa dacă respectiva categorie există – am putut face acest lucru datorită restricţiei ca fiecare categorie să aibă un propunător existent, vizibilă în <sup><a href="structure.html#img1">1</a></sup>.</li>
        </ul> 

        <p><span class="token"><a href="./sources/server/newssql.c">newssql.c</a></span> conţine funcţiile care tratează acţiunile referitoare la ştiri, interogând baza de date <span class="italic">MySQL</span>:</p>
        <ul type="disc">
            <li><span class="token">int sql_new_add(char *name, char *text, int catid)</span><br />adaugă o ştire, prin citirea şi procesarea datelor</li>
            <li><span class="token">int sql_new_modify(int id, char *name, char *text, int catid)</span><br />modifică o ştire, prin citirea şi procesarea identificatorului şi datelor</li>
            <li><span class="token">int sql_new_remove(int id)</span><br />şterge o ştire, prin citirea şi procesarea identificatorului</li>
            <li><span class="token">void sql_news_view(int catid, int levmax, int lev, int limit)</span><br />vizualizează recursiv ştirile</li>
            <li><span class="token">int sql_new_view(int id)</span><br />vizualizează o ştire, prin citirea şi procesarea identificatorului</li>
            <li><span class="token">int sql_new_user_exists(int id)</span><br />găseşte propunătorul unei ştiri; am folosit funcţia în dublu scop: şi pentru a găsi propunătorul, şi pentru a testa dacă respectiva ştire există – am putut face acest lucru datorită restricţiei ca fiecare ştire să aibă un propunător existent, vizibilă în <sup><a href="structure.html#img1">1</a></sup>.</li>
        </ul> 
        
        <h4>mostră cod</h4>
        
        <p>Prezentăm un exemplu de fişier sursă, <a href="./sources/server/newssql.c">newssql.c</a>:</p>
        <div class="pre token">
        
        
        
<span style='color: #060'>/*<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;2009,&nbsp;2010&nbsp;Vlad&nbsp;Manea,&nbsp;Sebastian&nbsp;Codrin&nbsp;Ditu<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;newshaolin.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newshaolin&nbsp;is&nbsp;free&nbsp;software:&nbsp;you&nbsp;can&nbsp;redistribute&nbsp;it&nbsp;and/or&nbsp;modify<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;as&nbsp;published&nbsp;by<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation,&nbsp;either&nbsp;version&nbsp;3&nbsp;of&nbsp;the&nbsp;License,&nbsp;or<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(at&nbsp;your&nbsp;option)&nbsp;any&nbsp;later&nbsp;version.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newshaolin&nbsp;is&nbsp;distributed&nbsp;in&nbsp;the&nbsp;hope&nbsp;that&nbsp;it&nbsp;will&nbsp;be&nbsp;useful,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;WITHOUT&nbsp;ANY&nbsp;WARRANTY;&nbsp;without&nbsp;even&nbsp;the&nbsp;implied&nbsp;warranty&nbsp;of<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MERCHANTABILITY&nbsp;or&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE.&nbsp;&nbsp;See&nbsp;the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;for&nbsp;more&nbsp;details.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;should&nbsp;have&nbsp;received&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;newshaolin.&nbsp;&nbsp;If&nbsp;not,&nbsp;see&nbsp;&lt;http://www.gnu.org/licenses/&gt;.<br /><br />*/</span><br /><br /><span style='color: #f60'>#include&nbsp;"newssql.h"</span><br /><span style='color: #f60'>#include&nbsp;"globals.h"</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;adaugare&nbsp;a&nbsp;unei&nbsp;stiri,&nbsp;care&nbsp;intoarce&nbsp;identificatorul&nbsp;stirii&nbsp;adaugate&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_add</span><span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;INSERT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"INSERT&nbsp;INTO&nbsp;news&nbsp;VALUES&nbsp;('',&nbsp;'%s',&nbsp;'%s',&nbsp;CONCAT(CURRENT_DATE(),&nbsp;'&nbsp;',&nbsp;CURRENT_TIME()),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'%d',&nbsp;'%d');"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>connected</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;adaug&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_query(conn,&nbsp;insert)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;category_id='%d'&nbsp;and&nbsp;user_id='%d'&nbsp;and&nbsp;name='%s'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;text='%s';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>connected</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>text</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aflu&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;citesc&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;valoarea&nbsp;raspunsului&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;primul&nbsp;camp&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;consider&nbsp;utilizator&nbsp;fictiv,&nbsp;dar&nbsp;e&nbsp;posibil&nbsp;sa&nbsp;fi&nbsp;fost&nbsp;sters!&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;modificare&nbsp;a&nbsp;unei&nbsp;stiri,&nbsp;care&nbsp;intoarce&nbsp;idul&nbsp;stirii&nbsp;modificate&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_modify</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_modify::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_modify::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_modify::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;INSERT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"UPDATE&nbsp;news&nbsp;SET&nbsp;name='%s',&nbsp;moment=CONCAT(CURRENT_DATE(),&nbsp;'&nbsp;',&nbsp;CURRENT_TIME()),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text='%s',&nbsp;category_id='%d'&nbsp;WHERE&nbsp;id='%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;adaug&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>id</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;stergere&nbsp;a&nbsp;unei&nbsp;stiri&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_remove</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;construiesc&nbsp;cererea&nbsp;sql&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"DELETE&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;'%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;adaug&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::mysql_query(conn,&nbsp;insert)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;am&nbsp;sters&nbsp;cu&nbsp;succes&nbsp;stirea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;recursiva&nbsp;de&nbsp;vizualizare&nbsp;a&nbsp;stirilor&nbsp;*/</span><br /><span style='color: #009'>void</span>&nbsp;<span style='color: #900'>sql_news_view</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>lev</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;verifica&nbsp;validitatea&nbsp;categoriei&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>user</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;identificatorul&nbsp;categoriei&nbsp;curente&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;numarul&nbsp;nivelului&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #666'>number</span><span style='color: #909'>[</span><span style='color: #066'>11</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;sa&nbsp;nu&nbsp;fi&nbsp;depasit&nbsp;nivelul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>levmax</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span>&nbsp;<span style='color: #909'>&amp;&amp;</span>&nbsp;<span style='color: #666'>lev</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;validitatea&nbsp;categoriei&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>user</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>sql_cat_user_exists</span><span style='color: #660'>(</span><span style='color: #666'>catid</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>&lt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id&nbsp;FROM&nbsp;categories&nbsp;WHERE&nbsp;parent_id&nbsp;IS&nbsp;NULL;"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;categoriile,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;valoarea&nbsp;identificatorului*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>id</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;reapelez&nbsp;cu&nbsp;categorie&nbsp;valida&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sql_news_view</span><span style='color: #660'>(</span><span style='color: #666'>id</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>lev</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;tratez&nbsp;si&nbsp;celalalt&nbsp;caz&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;trec&nbsp;la&nbsp;randul&nbsp;urmator&nbsp;extras&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>continue</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;tratez&nbsp;cazul&nbsp;cand&nbsp;categoria&nbsp;e&nbsp;valida&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>limit</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id,&nbsp;name,&nbsp;text,&nbsp;moment,&nbsp;category_id,&nbsp;user_id&nbsp;FROM&nbsp;news<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;category_id&nbsp;=&nbsp;'%d'&nbsp;ORDER&nbsp;BY&nbsp;moment&nbsp;DESC&nbsp;LIMIT&nbsp;%d;"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id,&nbsp;name,&nbsp;text,&nbsp;moment,&nbsp;category_id,&nbsp;user_id&nbsp;FROM&nbsp;news<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;category_id&nbsp;=&nbsp;'%d'&nbsp;ORDER&nbsp;BY&nbsp;moment&nbsp;DESC;"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;stirile,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;construiesc&nbsp;numarul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>number</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"%d"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>lev</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;nivelul&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>number</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;numele&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;textul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;momentul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;categoria&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>4</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;propunatorului&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>5</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id&nbsp;FROM&nbsp;categories&nbsp;WHERE&nbsp;parent_id&nbsp;=&nbsp;'%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;categoriile,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;valoarea&nbsp;identificatorului*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>id</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;reapelez&nbsp;cu&nbsp;categorie&nbsp;valida&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sql_news_view</span><span style='color: #660'>(</span><span style='color: #666'>id</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>lev</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;tratez&nbsp;si&nbsp;celalalt&nbsp;caz&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;trec&nbsp;la&nbsp;randul&nbsp;urmator&nbsp;extras&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>continue</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;vizualizareaa&nbsp;a&nbsp;news&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_view</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;*&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;id&nbsp;='%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;utilizatorul,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;construiesc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"success"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;numele&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;textul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;momentul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;categoria&nbsp;parinte&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>4</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;propunatorului&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>5</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;raspunsul&nbsp;este&nbsp;valid&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;eroare&nbsp;de&nbsp;id&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>errors</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;raspunsul&nbsp;este&nbsp;invalid&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;starea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;test&nbsp;a&nbsp;existentei&nbsp;unei&nbsp;stiri&nbsp;dupa&nbsp;id&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_user_exists</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;user_id&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;'%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;utilizatorul,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;daca&nbsp;am&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;primul&nbsp;camp&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;celalalt&nbsp;caz&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;consider&nbsp;stire&nbsp;fictiva,&nbsp;dar&nbsp;e&nbsp;posibil&nbsp;sa&nbsp;fi&nbsp;fost&nbsp;stearsa!&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style='color: #990'>}</span>
        
        
        
        
        
        
        </div>

	<hr />

        <h4>extensibilitate server</h4>
        <p>Pentru a extinde serverul cu noi comenzi, sunt necesare adăugarea acestora în sursa <span class="token"><a href="./sources/server/requests.c">requests.c</a></span>, precum şi adăugarea surselor respective. Mesajele de eroare, precum şi alte variabile globale, pot fi modificate din fişierul <span class="token"><a href="./sources/server/globals.c">globals.c</a></span>.</p>
        <p>Am implementat şi comentat codul serverului în scop educaţional. Datorită licenţei <a target="_blank" href="http://www.gnu.org/licenses/gpl.html">GNU GPL</a>, sub care a fost realizat, el poate fi dezvoltat mai departe de cine doreşte.</p>
        
        <hr />
        
        <p align="right" class="top"><a href="#">sus ↑</a></p>
    </div>
</body>
</html>
